{% extends "base.html" %}
{% block title %}Login{% endblock %}

{% block head %}
  <link rel="stylesheet" href="/static/css/auth.css">
{% endblock %}

{% block content %}
<div class="auth-shell">
  <!-- Decorative background orbs -->
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>
  <div class="bg-orb orb-3"></div>

  <div class="auth-grid">
    <!-- Left: Hero / Branding -->
    <section class="auth-hero">
      <div class="brand-row">
        <div class="logo-dot"></div>
        <h1 class="brand-name">{{ settings.APP_NAME or "Atharva's NAS" }}</h1>
      </div>
      <h2 class="hero-title">Access, manage, and preview your files with ease.</h2>
      <p class="hero-subtitle">
        Secure session, fast browsing, thumbnails, streaming, and search — all in one tidy interface.
      </p>
      <ul class="hero-list">
        <li>🔒 Cookies are HTTP-only and sessions are signed</li>
        <li>🖼️ Instant image previews (HEIC supported)</li>
        <li>🎞️ Video streaming with range requests</li>
        <li>🔎 Recursive search and smart sorting</li>
      </ul>
      <div class="hero-meta">
        <span class="chip">Optimized</span>
        <span class="chip">Reactive</span>
        <span class="chip">Themed</span>
      </div>
    </section>

    <!-- Right: Form -->
    <section class="auth-card glass" role="main" aria-labelledby="loginTitle">
      <header class="card-header">
        <h2 id="loginTitle" class="card-title">Sign In</h2>
        <p class="card-subtitle">Access your drives securely.</p>
      </header>

      {% if error %}
      <div class="auth-alert" role="alert" aria-live="assertive">
        <div class="alert-ico" aria-hidden="true">⚠️</div>
        <div class="alert-msg">{{ error }}</div>
        <button class="alert-close" type="button" aria-label="Dismiss error" data-alert-close>&times;</button>
      </div>
      {% endif %}

      <form id="loginForm" method="post" action="/auth/login" class="auth-form" autocomplete="on" novalidate>
        <input type="hidden" name="next" value="{{ next | default('/') }}">
        {% if csrf_token %}
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        {% endif %}

        <div class="field">
          <label for="username" class="field-label">👤 Username</label>
          <input
            type="text"
            id="username"
            name="username"
            class="field-input"
            placeholder="john_doe"
            autocomplete="username"
            required
            value="{{ username or '' }}"
            {% if not username %}autofocus{% endif %}
          >
          <span class="focus-underline"></span>
        </div>

        <div class="field">
          <label for="password" class="field-label">🔒 Password</label>
          <div class="pw-row">
            <input
              type="password"
              id="password"
              name="password"
              class="field-input"
              placeholder="••••••••"
              autocomplete="current-password"
              required
            >
            <button
              type="button"
              class="pw-toggle"
              id="pwToggle"
              aria-label="Show password"
              aria-pressed="false"
              title="Show/Hide password"
            >👁️</button>
          </div>
          <span class="focus-underline"></span>
        </div>

        <button class="btn-primary wide" type="submit">Sign In</button>

        <p class="form-note">Session secured with HTTP-only cookies. {{ settings.APP_NAME or "HDD Browser" }}</p>
      </form>
    </section>
  </div>

  <footer class="auth-footer">
    <span>© {{ 2025 }} Atharva's NAS • Enhanced UI</span>
    <span class="footer-meta">Optimized • Reactive • Themed</span>
  </footer>
</div>

<script>
  // Password toggle and dismissible alert
  (function(){
    const pw = document.getElementById("password");
    const toggle = document.getElementById("pwToggle");
    if (toggle && pw) {
      toggle.addEventListener("click", () => {
        const vis = pw.getAttribute("type") === "text";
        pw.setAttribute("type", vis ? "password" : "text");
        toggle.setAttribute("aria-pressed", String(!vis));
      });
    }
    document.querySelectorAll("[data-alert-close]").forEach(btn => {
      btn.addEventListener("click", () => btn.closest(".auth-alert")?.remove());
    });
  })();
</script>
{% endblock %}