{% extends "base.html" %}
{% block title %}Browse{% endblock %}

{% block content %}
<h2 class="page-title">Browse Files</h2>

<div class="toolbar glass">
  <div class="tool-group" style="display:flex; flex-wrap:wrap; align-items:center; gap:.9rem; width:100%;">
    <label class="label-chip label-inline">Drive
      <select id="driveSelect" class="input-select"></select>
    </label>

    <div class="path-display" id="currentPath"></div>

    <button id="upBtn" class="btn-soft">Back ⬅️</button>
    <button id="toggleViewBtn" data-mode="list" class="btn-soft">Grid View</button>

    <label class="label-chip label-inline" style="margin-left:.5rem;">
      Sort
      <select id="sortSelect" class="input-select">
        <option value="name" selected>Name (A→Z)</option>
        <option value="type">File Type</option>
      </select>
    </label>

    {% if can_upload and settings.ENABLE_UPLOAD %}
    <div id="uploadSection" class="upload-inline">
      <!-- context (kept in sync by JS) -->
      <input type="hidden" id="uploadDrive" value="">
      <input type="hidden" id="uploadRelPath" value="">

      <!-- Single visible button -->
      <button id="uploadBtn" class="btn-primary"
              title="Click to upload files. Press-and-hold, right-click, or Alt/Option-click to upload a folder.">
        Upload
      </button>

      <!-- Hidden native pickers -->
      <input type="file" id="fileInput" class="input-file" multiple style="display:none;" />
      <input type="file" id="folderInput" class="input-file" webkitdirectory directory style="display:none;" />

      <span id="uploadResult" class="upload-result" style="margin-left:.5rem;"></span>
    </div>
    {% endif %}
  </div>
</div>

<div id="entries" class="entries-surface list-mode skeleton-parent">
  <div class="skeleton-block"></div>
  <div class="skeleton-block w-70"></div>
  <div class="skeleton-block w-50"></div>
</div>

<div id="preview" class="preview-panel"></div>

<div id="lightbox" style="display:none;">
  <div id="lightboxContent" class="lightbox-inner scale-in">
    <button id="lightboxClose" class="lightbox-close" title="Close">&times;</button>
    <img id="lightboxImage" alt="preview" />
    <video id="lightboxVideo" controls style="display:none;"></video>
    <div id="lightboxCaption"></div>
    <div id="lightboxNav">
      <button id="lbPrev" class="btn-circle" title="Previous">&#9664;</button>
      <button id="lbNext" class="btn-circle" title="Next">&#9654;</button>
    </div>
  </div>
</div>
{% endblock %}

{% block head %}
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<link rel="stylesheet" href="/static/css/app.css">
{% endblock %}

{% block scripts %}
<script>
  // Make feature flags user-aware
  window.enableUpload = {{ (can_upload and settings.ENABLE_UPLOAD) | tojson }};
  window.enableDelete = {{ (can_delete and settings.ENABLE_DELETE) | tojson }};
  window.enableThumbs = {{ settings.ENABLE_THUMBNAILS | default(false) | tojson }};
</script>

<script src="/static/js/app.js" defer></script>
{% endblock %}